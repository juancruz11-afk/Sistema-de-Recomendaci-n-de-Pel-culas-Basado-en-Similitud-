<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Tus Recomendaciones</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  </head>
  <body>
    
    <nav class="navbar navbar-dark bg-black sticky-top">
      <div class="container-fluid">
        <a class="navbar-brand" href="/">Tus Recomendaciones</a>
        <a href="/" class="btn btn-outline-light btn-sm">Cambiar Filtros</a>
      </div>
    </nav>

    <main class="container-fluid py-5 px-5">
      
      <h3 class="mb-4">Top Picks para el Usuario <span class="text-danger">#{{ user }}</span></h3>

      <section class="row row-cols-1 row-cols-sm-2 row-cols-md-4 row-cols-lg-5 g-4 mb-5">
        {% for r in recs %}
        <div class="col">
          <div class="card movie-card h-100">
            <div class="badge-score">{{ (r.score * 100)|round|int }}% Match</div>
            
            {% if r.poster_url %}
            <img src="{{ r.poster_url }}" class="card-img-top" alt="poster">
            {% else %}
            <div class="card-img-top d-flex align-items-center justify-content-center bg-secondary" style="height: 400px;">
                <span class="h1 text-white">?</span>
            </div>
            {% endif %}
            
            <div class="card-body">
              <h6 class="card-title text-white text-truncate" title="{{ r.title }}">{{ r.title }}</h6>
              <p class="card-text text-muted small">
                Rating: {{ r.avg_rating }} ⭐ <br>
                <span class="text-truncate d-block">{{ r.genres }}</span>
              </p>
            </div>
          </div>
        </div>
        {% else %}
        <p class="text-white">No encontramos recomendaciones con esos filtros :(</p>
        {% endfor %}
      </section>

      <hr class="border-secondary">

      <h4 class="mt-5 mb-3 text-secondary">Historial de Calificaciones</h4>
      <div class="table-responsive">
        <table class="table table-dark-custom table-hover">
          <thead>
            <tr>
              <th>Película</th>
              <th>Tu Rating</th>
              <th>Global Rating</th>
            </tr>
          </thead>
          <tbody>
            {% for c in ratings %}
            <tr>
              <td>{{ c.title }}</td>
              <td>{{ c.rating }}</td>
              <td>{{ c.avg_rating }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    </main>
  </body>
</html>